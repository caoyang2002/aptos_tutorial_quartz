---
title: 深入浅出WASM
---
WebAssembly (简称 Wasm) 是一种新型的**二进制代码格式**，包含这种二进制代码格式的文件可以用类似加载模块的方式被浏览器快速、高效地解析和执行。不仅如此，Wasm 并不像 NaCl 应用那样需要区分浏 览器运行所在计算机的具体处理器架构，这使得它可以被随意地分发到互联网上，只要位于用户端的浏览器支持 Wasm 格式，用户便可以正常使用其中的功能。

Wasm 的堆栈式机器结构被设计编码成一种高密度、可以被浏览器快速加载和执行的二进制格式。Wasm 的设计目标是，希望浏览器能够 以近似原生 C/C++ 应用的运行速度，来调用 Wasm 模块中包含的那些在各类型平台(处理器架构)上都可以使用的通用硬件功能。Wasm 描述了 一个内存安全的沙箱执行环境，可以在现有的 JavaScript 虚拟机中进行实现。当在浏览器中运行一个 Wasm 模块时，Wasm 将遵循浏览器中 与 Web 应用一致的同源策略来保证其安全性。

为了能够方便地对 Wasm 模块进行调试，Wasm 标准针对 Wasm 的原始 二进制格式设计了一种名为 “WAT(WebAssembly Text Format)” 的 可读文本格式，对应于该可读文本格式的文本文件也同样以 “.wat”  作为后缀。WAT 中的语法结构直接对应着模块的功能和业务逻辑，而这对于深入理解模块的运行机制和对模块的细节进行优化提供了很大的帮助。

Wasm 模块可以通过 JavaScript 提供的上层 Web API 来调用浏览器本身的功能，比如与浏览器在显示的 DOM 内容上进行交互。同时， WebAssembly 不仅可以应用在 Web 浏览器上，它还可以应用在一些非Web 相关的场景中，比如 Node.js 环境下的后端应用甚至是物联网 (IoT) 应用。只要这些场景能够提供一个完备的 Wasm 虚拟机便可以正常地解析 Wasm 模块。

我们之前介绍过，V8 引擎在解析一段 JavaScript 代码时需要经过 一系列的解析器和编译器链路 (我们称之为 V8 的 Pipeline 链路)。如 图 1-27 所示，JavaScript 会经过链路中各个编译器前置 Parser 的语法分析，最后被转换成 AST 这种中间数据格式，AST 描述了 JavaScript 代码在内存中的语法结构。对应于 Parser 的Parsing过程又被分为Full- Parsing和Pre-Parsing两种类型，这两种过程都需要消耗一定的系统 资源。并且，由于 JavaScript 本身是一种弱类型编程语言，在根据 JavaScript 源代码生成对应机器码的过程中，编译器类型推断、优化 和去优化等过程也会额外消耗一定的系统资源。